version: 2.1

jobs:
  test:
    machine:
      image: ubuntu-2204:2022.04.2
    steps:
      - checkout
      - run: echo "No test suit available (:"

  prod:
    docker:
      - image: python:latest
    steps:
      - checkout
      - run:
          name: Update cache
          command: apt update

      - run:
          name: Install ansible
          command: pip install ansible
      - run:
          name: Install ssh for login
          command: apt install sshpass

      - run:
          no_output_timeout: 320m
          name: Deploy app in production
          command: ansible-playbook ./infrastructure/deploy.yml

      - run:
          name: Setting network and configure firewall
          command: ansible-playbook ./infrastructure/network.yml

workflows:
 catalogue:
    jobs:
      - test
      - prod:
          requires:
            - test
          filters:
            branches:
              only: master
